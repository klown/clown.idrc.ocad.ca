<!DOCTYPE html>
<html>
<head>
<script type="text/javascript">

    var pwdUI;
    var realPwd;
    var showPassword;
    var echoKeys;
    var deleteState = false;

    function init() {
        pwdUI = document.getElementById ('pwdUI');
        realPwd = document.getElementById ('realPwd');
        showPassword = document.getElementById ('demo');
        echoKeys = document.getElementById ('keys');
        
        pwdUI.addEventListener ('keypress', handleKeyPress);
//        pwdUI.addEventListener ('keyup', handleKeyPress);
    }
    
    function handleKeyPress (keyEvent) {
        if (isSpecial (keyEvent) && !deleteState)
            return;
        
        var keyText = String.fromCharCode (keyEvent.which || keyEvent.keyCode);
        if (!deleteState) {
            echoKey (keyText);
            storeAndObscure (keyText);
            showValue();
            keyEvent.preventDefault();
        }
        
        // Dangerous as this predicts what the password will be after deletion.
        else {
            var afterDeletion;
            
            // Check for one character deleted
            if (pwdUI.selectionStart === pwdUI.selectionEnd) {
                // Check for empty input field.
                if (pwdUI.value.length === 0) {
                    afterDeletion = "";
                    realPwd.value = "";
                }
                else {
                    afterDeletion = realPwd.value.slice (0, pwdUI.selectionStart-1);
                }
            }
            else {
                afterDeletion = realPwd.value.slice (0, pwdUI.selectionStart);
            }
            afterDeletion += realPwd.value.slice (pwdUI.selectionEnd);
            realPwd.value = afterDeletion;
            echoKey (keyText);
            showValue();
            deleteState = false;
        }   
    }

    function echoKey (keyText) {
        echoKeys.innerHTML = keyText;
    }
    
    function showValue (keyEvent) {
        showPassword.innerHTML = realPwd.value;
    }
    
    function storeAndObscure (keyText) {
        if (pwdUI.selectionStart === pwdUI.value.length) {
            realPwd.value += keyText;
        }
        else {
            var newString = realPwd.value.slice (0, pwdUI.selectionStart);
            newString += keyText;
            newString += realPwd.value.slice (pwdUI.selectionEnd);
            realPwd.value = newString;
        }
        pwdUI.value = '*'.repeat (realPwd.value.length);
    }
    
    function isSpecial (keyEvent) {
        return (
            (preProcessDelete (keyEvent) ) ||
            (keyEvent.code.indexOf ("Arrow") !== -1) ||
            (keyEvent.altKey || keyEvent.ctrlKey || keyEvent.metaKey) ||
            (keyEvent.keyCode === 8 /* Delete */)
        );
    }
    
    function preProcessDelete (keyEvent) {
        if (keyEvent.keyCode === 8) /* Delete */ {
            deleteState = true;
        }
        else if (keyEvent.ctrlKey) {
            // Check for backspace: ctrl-h or ctrl-H
            var key = (keyEvent.which || keyEvent.keyCode);
            if (key === 104 || key === 72) {
                deleteState = true;
            }
        }
        else {
            deleteState = false;
        }
        return deleteState;
    }

</script>
</head>
<body onload="init()">

<p>A form with an html5 &lt;input&gt; type="text" field used as a password:</p>

<form>
  <label for="thePwd">Password:</label> <input id="pwdUI" type="text" name="pw" pattern=".{6,}" title="Six or more characters">
  <input id="realPwd" type="hidden" name="realPwd" value="">
</form>

<p>The password is: <span id="demo" style="margin-left: 0.5em; padding-left: 0.5em; padding-right: 0.5em; border: 1px solid blue"></span></p>
<p>Key: <span id="keys" style="margin-left: 0.5em; padding-left: 0.5em; padding-right: 0.5em; border: 1px solid blue"></span></p>

</body>
</html>